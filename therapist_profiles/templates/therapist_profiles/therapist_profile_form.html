{% extends 'base.html' %}
{% load static %}
{% block title %}
Edit Profile
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Edit Your Profile</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Profile Fields -->
        <h3>Profile Information</h3>
        <div class="mb-3">
            <label for="bio" class="form-label">Bio</label>
            {{ form.bio }}
        </div>

        <div class="mb-3">
            <label for="credentials" class="form-label">Credentials</label>
            {{ form.credentials }}
        </div>

        <div class="mb-3">
            <label for="services" class="form-label">Services Offered</label>
            {{ form.services }}
        </div>

        <div class="mb-3">
            <label for="photo" class="form-label">Profile Picture</label>
            {{ form.photo }}
            {% if form.instance.photo %}
            <img id="profile-preview" src="{{ form.instance.photo.url }}" alt="Profile Picture Preview"
                class="img-thumbnail mt-3" style="display: block; width: 150px; height: 150px;">
            {% else %}
            <img id="profile-preview" src="#" alt="Profile Picture Preview" class="img-thumbnail mt-3"
                style="display: none; width: 150px; height: 150px;">
            {% endif %}
        </div>


        <!-- Availability -->
        <h3>Availability</h3>
        <div id="availability-container">
            {{ formset.management_form }}
            {% for availability_form in formset %}
            <div class="row mb-3">
                <div class="col-md-4">
                    <label>Day</label>
                    {{ availability_form.day }}
                </div>
                <div class="col-md-3">
                    <label>Start Time</label>
                    {{ availability_form.start_time }}
                </div>
                <div class="col-md-3">
                    <label>End Time</label>
                    {{ availability_form.end_time }}
                </div>
                <div class="col-md-2">
                    <label>Delete</label>
                    {{ availability_form.DELETE }}
                </div>
            </div>
            {% endfor %}
        </div>
        <button id="add-availability" class="btn btn-primary mt-3">Add Availability</button>



        <!-- Submit Button -->
        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-success">Save Changes</button>
            <a href="{% url 'therapist_profile' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<!-- JavaScript for Profile Picture Preview -->
<script>
    const photoInput = document.getElementById('id_photo');
    const profilePreview = document.getElementById('profile-preview');

    photoInput.addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                profilePreview.src = e.target.result;
                profilePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });
</script>

<!-- Flatpickr for Time Selection -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        flatpickr("input[type='time']", {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i"
        });
    });
</script>

<script src="{% static '/js/script.js' %}"></script>

{% endblock %}